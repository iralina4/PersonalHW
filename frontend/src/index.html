<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–ì–≠ –†–µ–ø–µ—Ç–∏—Ç–æ—Ä - –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">–ï–ì–≠ –†–µ–ø–µ—Ç–∏—Ç–æ—Ä</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showPage('home')" class="nav-btn active" id="homeBtn">–ì–ª–∞–≤–Ω–∞—è</button>
                        <button onclick="showPage('student')" class="nav-btn" id="studentBtn">–ü—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞</button>
                        <button onclick="showPage('generate')" class="nav-btn" id="generateBtn">–°–æ–∑–¥–∞—Ç—å –î–ó</button>
                        <button onclick="showPage('addTask')" class="nav-btn" id="addTaskBtn">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏</button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <div id="homePage" class="page">
                <div class="text-center">
                    <h1 class="text-4xl font-bold text-gray-900 mb-8">
                        –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ
                    </h1>
                    
                    <div class="grid md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-3xl mb-4">üë§</div>
                            <h3 class="text-xl font-semibold mb-2">–ü—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞</h3>
                            <p class="text-gray-600 mb-4">–°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</p>
                            <button onclick="showPage('student')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                –ü–µ—Ä–µ–π—Ç–∏
                            </button>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-3xl mb-4">üéØ</div>
                            <h3 class="text-xl font-semibold mb-2">–°–æ–∑–¥–∞—Ç—å –î–ó</h3>
                            <p class="text-gray-600 mb-4">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π –ø–æ —Ç–µ–º–∞–º</p>
                            <button onclick="showPage('generate')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                                –ü–µ—Ä–µ–π—Ç–∏
                            </button>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-3xl mb-4">üìö</div>
                            <h3 class="text-xl font-semibold mb-2">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏</h3>
                            <p class="text-gray-600 mb-4">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –∑–∞–¥–∞—á</p>
                            <button onclick="showPage('addTask')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                                –ü–µ—Ä–µ–π—Ç–∏
                            </button>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="text-3xl mb-4">üìä</div>
                            <h3 class="text-xl font-semibold mb-2">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div id="statsContent" class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è –î–ó -->
            <div id="generatePage" class="page hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è</h1>
                
                <div class="bg-white shadow rounded-lg p-6">
                    <form id="generateForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</label>
                            <select id="selectedStudent" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤...</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–º—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á *</label>
                            <textarea id="topicsText" required rows="4" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                      placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: –ê–ª–≥–µ–±—Ä–∞ ‚Äî 3, –ì–µ–æ–º–µ—Ç—Ä–∏—è ‚Äî 2"></textarea>
                            
                            <div class="mt-4 grid md:grid-cols-2 gap-2">
                                <button type="button" onclick="setTopics('–ê–ª–≥–µ–±—Ä–∞ ‚Äî 3, –ì–µ–æ–º–µ—Ç—Ä–∏—è ‚Äî 2')" 
                                        class="text-left px-3 py-2 text-sm bg-gray-50 hover:bg-gray-100 rounded border">
                                    –ê–ª–≥–µ–±—Ä–∞ ‚Äî 3, –ì–µ–æ–º–µ—Ç—Ä–∏—è ‚Äî 2
                                </button>
                                <button type="button" onclick="setTopics('–õ–æ–≥–∞—Ä–∏—Ñ–º—ã ‚Äî 2, –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è ‚Äî 2')" 
                                        class="text-left px-3 py-2 text-sm bg-gray-50 hover:bg-gray-100 rounded border">
                                    –õ–æ–≥–∞—Ä–∏—Ñ–º—ã ‚Äî 2, –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è ‚Äî 2
                                </button>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="flex items-center">
                                <input type="checkbox" id="includePart2" class="mr-2">
                                <label for="includePart2" class="text-sm text-gray-900">–í–∫–ª—é—á–∏—Ç—å –∑–∞–¥–∞—á–∏ —á–∞—Å—Ç–∏ 2</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="makeTwoPdfs" checked class="mr-2">
                                <label for="makeTwoPdfs" class="text-sm text-gray-900">–°–æ–∑–¥–∞—Ç—å –¥–≤–∞ PDF</label>
                            </div>
                        </div>

                        <button type="submit" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
                        </button>
                    </form>

                    <div id="generateResult" class="mt-6 hidden"></div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á -->
            <div id="addTaskPage" class="page hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ –±–∞–∑—É</h1>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
                        
                        <form id="singleTaskForm" class="space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–º–∞ *</label>
                                    <select id="taskTopic" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</option>
                                        <option value="–ê–ª–≥–µ–±—Ä–∞">–ê–ª–≥–µ–±—Ä–∞</option>
                                        <option value="–ì–µ–æ–º–µ—Ç—Ä–∏—è">–ì–µ–æ–º–µ—Ç—Ä–∏—è</option>
                                        <option value="–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</option>
                                        <option value="–õ–æ–≥–∞—Ä–∏—Ñ–º—ã">–õ–æ–≥–∞—Ä–∏—Ñ–º—ã</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–°–ª–æ–∂–Ω–æ—Å—Ç—å *</label>
                                    <select id="taskDifficulty" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>
                                        <option value="1">1 - –õ–µ–≥–∫–∞—è</option>
                                        <option value="2">2 - –õ–µ–≥–∫–∞—è</option>
                                        <option value="3">3 - –°—Ä–µ–¥–Ω—è—è</option>
                                        <option value="4">4 - –°–ª–æ–∂–Ω–∞—è</option>
                                        <option value="5">5 - –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–∞—è</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                                <textarea id="statementText" required rows="4" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–û—Ç–≤–µ—Ç</label>
                                <input type="text" id="taskAnswer" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...">
                            </div>

                            <button type="submit" class="w-full bg-purple-500 text-white px-6 py-2 rounded hover:bg-purple-600">
                                –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
                            </button>
                        </form>

                        <div id="taskResult" class="mt-6 hidden"></div>
                    </div>

                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-4">üì¶ –ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–î–∞–Ω–Ω—ã–µ JSONL</label>
                                <textarea id="importData" rows="8" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm"
                                          placeholder='{"topic": "–ê–ª–≥–µ–±—Ä–∞", "difficulty": 3, "statement_text": "...", "answer": "..."}'></textarea>
                            </div>

                            <button onclick="importTasks()" class="w-full bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                                –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
                            </button>
                        </div>

                        <div id="importResult" class="mt-6 hidden"></div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
            <div id="studentPage" class="page hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —É—á–µ–Ω–∏–∫–∞</h1>
                
                <div class="bg-white shadow rounded-lg p-6">
                    <form id="studentForm" class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è —É—á–µ–Ω–∏–∫–∞ *</label>
                                <input type="text" id="studentName" required 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="studentEmail" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                       placeholder="student@example.com">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ö–ª–∞—Å—Å</label>
                                <select id="grade" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    <option value="10">10 –∫–ª–∞—Å—Å</option>
                                    <option value="11" selected>11 –∫–ª–∞—Å—Å</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–¶–µ–ª–µ–≤–æ–π –±–∞–ª–ª</label>
                                <input type="number" id="targetScore" min="0" max="100" value="80"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–º–ø</label>
                                <select id="pace" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    <option value="slow">–ú–µ–¥–ª–µ–Ω–Ω—ã–π</option>
                                    <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="fast">–ë—ã—Å—Ç—Ä—ã–π</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–°–ª–∞–±—ã–µ —Ç–µ–º—ã</label>
                            <textarea id="weakTopics" rows="3" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                      placeholder="–õ–æ–≥–∞—Ä–∏—Ñ–º—ã, –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è, –ü–∞—Ä–∞–º–µ—Ç—Ä—ã"></textarea>
                        </div>

                        <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                            –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞
                        </button>
                    </form>

                    <div id="studentResult" class="mt-6 hidden"></div>
                </div>
            </div>
        </main>
    </div>

    <style>
        .nav-btn {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-btn:hover {
            color: #374151;
            background-color: #f3f4f6;
        }
        .nav-btn.active {
            color: #2563eb;
            background-color: #dbeafe;
        }
        .page {
            padding: 24px 16px;
        }
        .hidden {
            display: none !important;
        }
    </style>

    <script>
        const API_BASE = 'http://localhost:8000';

        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageName + 'Page').classList.remove('hidden');
            document.getElementById(pageName + 'Btn').classList.add('active');
            
            if (pageName === 'generate') loadStudents();
        }

        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE}/api/students/`);
                const students = await response.json();
                
                const select = document.getElementById('selectedStudent');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</option>';
                
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (ID: ${student.id})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–µ–Ω–∏–∫–æ–≤:', error);
            }
        }

        async function loadStats() {
            try {
                const [tasksResponse, studentsResponse] = await Promise.all([
                    fetch(`${API_BASE}/api/tasks/?limit=100`),
                    fetch(`${API_BASE}/api/students/`)
                ]);
                
                const tasks = await tasksResponse.json();
                const students = await studentsResponse.json();
                
                document.getElementById('statsContent').innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-blue-600">${tasks.length}</div>
                            <div class="text-sm text-gray-600">–ó–∞–¥–∞—á –≤ –±–∞–∑–µ</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-green-600">${students.length}</div>
                            <div class="text-sm text-gray-600">–£—á–µ–Ω–∏–∫–æ–≤</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('statsContent').innerHTML = 
                    '<p class="text-red-600 text-sm">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞
        document.getElementById('studentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentData = {
                name: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value || 'student@example.com'
            };

            try {
                const response = await fetch(`${API_BASE}/api/students/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(studentData)
                });
                
                const student = await response.json();
                
                const profileData = {
                    grade: parseInt(document.getElementById('grade').value),
                    target_score: parseInt(document.getElementById('targetScore').value),
                    pace: document.getElementById('pace').value,
                    weak_topics: document.getElementById('weakTopics').value.split(',').map(s => s.trim()).filter(s => s)
                };
                
                await fetch(`${API_BASE}/api/students/${student.id}/profile`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                document.getElementById('studentResult').classList.remove('hidden');
                document.getElementById('studentResult').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800">‚úÖ –£—á–µ–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω</h3>
                        <p>–ò–º—è: ${student.name}</p>
                        <p>ID: ${student.id}</p>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('studentResult').classList.remove('hidden');
                document.getElementById('studentResult').innerHTML = 
                    `<div class="bg-red-50 p-4 rounded-lg">
                        <p class="text-red-800">–û—à–∏–±–∫–∞: ${error.message}</p>
                    </div>`;
            }
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏—è
        document.getElementById('generateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentId = document.getElementById('selectedStudent').value;
            if (!studentId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞');
                return;
            }

            const assignmentData = {
                student_id: parseInt(studentId),
                topics_text: document.getElementById('topicsText').value,
                options: {
                    include_part2: document.getElementById('includePart2').checked,
                    make_two_pdfs: document.getElementById('makeTwoPdfs').checked
                }
            };

            try {
                const response = await fetch(`${API_BASE}/api/assignments/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(assignmentData)
                });
                
                const result = await response.json();
                
                const assignmentResponse = await fetch(`${API_BASE}/api/assignments/${result.assignment_id}`);
                const assignment = await assignmentResponse.json();
                
                document.getElementById('generateResult').classList.remove('hidden');
                document.getElementById('generateResult').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800">‚úÖ –ó–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ</h3>
                        <p>ID: ${result.assignment_id}</p>
                        <p>–ó–∞–¥–∞—á: ${assignment.items.length}</p>
                        <div class="mt-4 space-y-2">
                            <a href="${API_BASE}${result.download_urls.student}" target="_blank" 
                               class="block bg-blue-500 text-white px-4 py-2 rounded text-center hover:bg-blue-600">
                                üì• PDF –¥–ª—è —É—á–µ–Ω–∏–∫–∞
                            </a>
                            <a href="${API_BASE}${result.download_urls.teacher}" target="_blank"
                               class="block bg-green-500 text-white px-4 py-2 rounded text-center hover:bg-green-600">
                                üì• PDF –¥–ª—è —É—á–∏—Ç–µ–ª—è
                            </a>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('generateResult').classList.remove('hidden');
                document.getElementById('generateResult').innerHTML = 
                    `<div class="bg-red-50 p-4 rounded-lg">
                        <p class="text-red-800">–û—à–∏–±–∫–∞: ${error.message}</p>
                    </div>`;
            }
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        document.getElementById('singleTaskForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const taskData = {
                topic: document.getElementById('taskTopic').value,
                difficulty: parseInt(document.getElementById('taskDifficulty').value),
                statement_text: document.getElementById('statementText').value,
                answer: document.getElementById('taskAnswer').value || null,
                skills: [],
                tags: []
            };

            try {
                const response = await fetch(`${API_BASE}/api/tasks/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(taskData)
                });
                
                const result = await response.json();
                
                document.getElementById('taskResult').classList.remove('hidden');
                document.getElementById('taskResult').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800">‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞</h4>
                        <p>ID: ${result.id}</p>
                        <p>–¢–µ–º–∞: ${result.topic}</p>
                    </div>
                `;
                
                document.getElementById('singleTaskForm').reset();
                
            } catch (error) {
                document.getElementById('taskResult').classList.remove('hidden');
                document.getElementById('taskResult').innerHTML = 
                    `<div class="bg-red-50 p-4 rounded-lg">
                        <p class="text-red-800">–û—à–∏–±–∫–∞: ${error.message}</p>
                    </div>`;
            }
        });

        async function importTasks() {
            const importData = document.getElementById('importData').value.trim();
            if (!importData) {
                alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                return;
            }

            try {
                const lines = importData.split('\n').filter(line => line.trim());
                const tasks = lines.map(line => JSON.parse(line));
                
                const response = await fetch(`${API_BASE}/api/tasks/import`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tasks })
                });
                
                const result = await response.json();
                
                document.getElementById('importResult').classList.remove('hidden');
                document.getElementById('importResult').innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800">‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω</h4>
                        <p>–ó–∞–¥–∞—á: ${result.total_tasks}</p>
                    </div>
                `;
                
                document.getElementById('importData').value = '';
                
            } catch (error) {
                document.getElementById('importResult').classList.remove('hidden');
                document.getElementById('importResult').innerHTML = 
                    `<div class="bg-red-50 p-4 rounded-lg">
                        <p class="text-red-800">–û—à–∏–±–∫–∞: ${error.message}</p>
                    </div>`;
            }
        }

        function setTopics(text) {
            document.getElementById('topicsText').value = text;
        }

        window.addEventListener('load', loadStats);
    </script>
</body>
</html>
